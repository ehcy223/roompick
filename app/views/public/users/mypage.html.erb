<% content_for :title, "マイページ" %>

<div class="container py-4">
  <!-- ユーザー概要 -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex flex-wrap align-items-center gap-3">
      <div class="flex-grow-1">
        <h1 class="h4 mb-1"><%= @user.name.presence || @user.email %></h1>
        <div class="text-muted small">登録日: <%= l(@user.created_at.to_date) rescue @user.created_at.to_date %></div>
      </div>
      <div class="ms-auto d-flex gap-2">
        <%= link_to "プロフィール編集", edit_user_path(@user), class: "btn btn-outline-primary" %>
        <%= link_to "新規投稿", new_post_path, class: "btn btn-primary" %>
      </div>
    </div>
  </div>

  <!-- 投稿一覧 -->
  <h2 class="h5 mb-3">最近の投稿</h2>
  <% if @posts.present? %>
    <div class="row g-3">
      <% @posts.each do |post| %>
        <div class="col-12 col-md-6">
          <div class="card h-100 shadow-sm">
            <% if post.respond_to?(:image) && (post.image.respond_to?(:attached?) ? post.image.attached? : post.image.present?) %>
              <%= link_to post_path(post) do %>
                <%= image_tag post.image, class: "card-img-top post-thumb", alt: post.title %>
              <% end %>
            <% end %>

            <div class="card-body d-flex flex-column">
              <h3 class="h6 mb-2">
                <%= link_to post.title, post_path(post), class: "text-decoration-none" %>
              </h3>
              <p class="text-muted small mb-2">
                <%= truncate(post.body.to_s, length: 80) %>
              </p>
              <div class="mt-auto d-flex justify-content-between align-items-center small text-muted">
                <% if post.respond_to?(:rating) && post.rating.present? %>
                  <span>評価: <%= "★" * post.rating.to_i %></span>
                <% end %>
                <span><%= l(post.created_at.to_date) rescue post.created_at.to_date %></span>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-muted">まだ投稿がありません。</p>
  <% end %>
</div>